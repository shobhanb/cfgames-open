<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin"></ion-back-button>
    </ion-buttons>
    <ion-title>Schedule Preferences</ion-title>
    <app-toolbar-buttons slot="end"></app-toolbar-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  @if (!editPrefs()) {
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  }

  <ion-card>
    <ion-card-header>
      <ion-card-title>Select Athlete</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-button expand="block" (click)="onSelectAthlete()">
        @if (selectedAthleteName()) { {{ selectedAthleteName() }} } @else {
        Select an Athlete }
      </ion-button>
    </ion-card-content>
  </ion-card>

  @if (selectedAthleteName() && dataLoaded()) {
  <ion-card>
    <ion-card-header>
      <ion-card-title>Schedule Preferences</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-note>
        NOTE: These are just scheduling preferences. Athletes will be assigned a
        time slot based on their preferences, heat/gear planning, luck, and
        several other factors.
      </ion-note>
      <br />
      <ion-label
        >If the athlete will not be participating this weekend, select NA as their first
        preference or click on the "Not available" button</ion-label
      >
    </ion-card-content>
  </ion-card>

  <ion-button
    size="medium"
    fill="outline"
    expand="block"
    class="ion-margin-horizontal"
    [color]="isNotAvailable() ? 'primary' : 'danger'"
    (click)="onToggleAvailability()"
  >
    {{ isNotAvailable() ? 'Athlete is available this weekend' : 'Athlete is not available
    this weekend' }}
  </ion-button>

  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ selectedAthleteName() }}'s Preferences</ion-card-title>
      <div class="button-container">
        @if (editPrefs()) {
        <ion-button size="medium" fill="solid" (click)="onClickDone()">
          Done
        </ion-button>
        <ion-button
          size="medium"
          fill="clear"
          color="danger"
          (click)="onClickCancel()"
        >
          Cancel
        </ion-button>
        } @else {
        <ion-button size="medium" fill="clear" (click)="onClickEdit()">
          Edit
        </ion-button>
        }
      </div>
    </ion-card-header>
    <ion-card-content>
      <ion-list [inset]="true">
        <ion-reorder-group
          [disabled]="!editPrefs()"
          (ionItemReorder)="handleReorder($any($event))"
        >
          @for (pref of prefs(); track $index) {
          <ion-item>
            <ion-note slot="start">{{ 'Pref ' + ($index + 1) }}</ion-note>
            <ion-label>{{ pref }}</ion-label>
            <ion-reorder slot="end"></ion-reorder>
          </ion-item>
          }
        </ion-reorder-group>
      </ion-list>
    </ion-card-content>
  </ion-card>
  } @else if (selectedAthleteName() && !dataLoaded()) {
  <ion-card>
    <ion-card-header>
      <ion-skeleton-text
        animated
        style="width: 40%; height: 24px"
      ></ion-skeleton-text>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-reorder-group disabled="true">
          @for (i of [1, 2, 3, 4]; track $index) {
          <ion-item>
            <ion-note slot="start">
              <ion-skeleton-text
                animated
                style="width: 40px; height: 16px"
              ></ion-skeleton-text>
            </ion-note>
            <ion-label>
              <ion-skeleton-text
                animated
                style="width: 80px; height: 16px"
              ></ion-skeleton-text>
            </ion-label>
            <ion-reorder slot="end"></ion-reorder>
          </ion-item>
          }
        </ion-reorder-group>
      </ion-list>
    </ion-card-content>
  </ion-card>
  }
</ion-content>
