<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button
        defaultHref="/admin/appreciation-results"
      ></ion-back-button>
    </ion-buttons>
    <ion-title
      >{{ eventService.getWeekendEventName(ordinal, year) + '
      Appreciation'}}</ion-title
    >
    <app-toolbar-buttons slot="end"></app-toolbar-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  @if ( dataLoaded()) {

  <div class="section-title">Legend (Votes from)</div>

  <div class="medal-legend">
    <div class="legend-item">
      <ion-chip class="team mini">
        <ion-label>0</ion-label>
      </ion-chip>
      <span>Same Team</span>
    </div>
    <div class="legend-item">
      <ion-chip class="non-team mini">
        <ion-label>0</ion-label>
      </ion-chip>
      <span>Different Team</span>
    </div>
    <div class="legend-item">
      <ion-chip class="total mini">
        <ion-label>0</ion-label>
      </ion-chip>
      <span>Total</span>
    </div>
  </div>

  <div class="section-title">Sort by (Descending)</div>
  <ion-list [inset]="true">
    <ion-item>
      <ion-select
        [value]="sortBy()"
        (ionChange)="handleSortChange($event)"
        interface="popover"
        labelPlacement="stacked"
      >
        <ion-select-option value="total_votes">Total Votes</ion-select-option>
        <ion-select-option value="team_votes"
          >Same Team Votes</ion-select-option
        >
        <ion-select-option value="non_team_votes"
          >Different Team Votes</ion-select-option
        >
      </ion-select>
    </ion-item>
  </ion-list>

  <div class="section-title">Vote Counts</div>
  <ion-list [inset]="true" class="results-list">
    @for (item of sortedResults(); track $index) {
    <ion-item
      class="result-item"
      [button]="true"
      [routerLink]="'/admin/appreciation-results/' + year + '/' + ordinal + '/' + item.crossfit_id"
    >
      <ion-note slot="start">{{ $index + 1 }}</ion-note>
      <div class="athlete-info">
        <ion-label class="athlete-name">
          {{ athleteDataService.getAthleteName(item.crossfit_id) }}
        </ion-label>
        <ion-note class="team-name">
          {{ athleteDataService.getTeamName(item.crossfit_id) }}
        </ion-note>
      </div>
      <div slot="end" class="scores-container">
        <ion-chip class="team">
          <ion-label>{{ item.team_votes }}</ion-label>
        </ion-chip>
        <ion-chip class="non-team">
          <ion-label>{{ item.non_team_votes }}</ion-label>
        </ion-chip>
        <ion-chip class="total">
          <ion-label>{{ item.total_votes }}</ion-label>
        </ion-chip>
      </div>
    </ion-item>
    }
  </ion-list>
  } @else {
  <!-- Skeleton loader -->
  <div class="section-title">
    <ion-skeleton-text
      [animated]="true"
      style="width: 120px; height: 18px"
    ></ion-skeleton-text>
  </div>

  <div class="medal-legend">
    <div class="legend-item">
      <ion-skeleton-text
        [animated]="true"
        style="width: 18px; height: 18px; border-radius: 4px"
      ></ion-skeleton-text>
      <ion-skeleton-text
        [animated]="true"
        style="width: 60px; height: 12px"
      ></ion-skeleton-text>
    </div>
    <div class="legend-item">
      <ion-skeleton-text
        [animated]="true"
        style="width: 18px; height: 18px; border-radius: 4px"
      ></ion-skeleton-text>
      <ion-skeleton-text
        [animated]="true"
        style="width: 80px; height: 12px"
      ></ion-skeleton-text>
    </div>
    <div class="legend-item">
      <ion-skeleton-text
        [animated]="true"
        style="width: 18px; height: 18px; border-radius: 4px"
      ></ion-skeleton-text>
      <ion-skeleton-text
        [animated]="true"
        style="width: 70px; height: 12px"
      ></ion-skeleton-text>
    </div>
  </div>

  <div class="section-title">
    <ion-skeleton-text
      [animated]="true"
      style="width: 150px; height: 18px"
    ></ion-skeleton-text>
  </div>

  <ion-list [inset]="true">
    <ion-item>
      <ion-skeleton-text
        [animated]="true"
        style="width: 80%; height: 40px; border-radius: 4px"
      ></ion-skeleton-text>
    </ion-item>
  </ion-list>

  <div class="section-title">
    <ion-skeleton-text
      [animated]="true"
      style="width: 100px; height: 18px"
    ></ion-skeleton-text>
  </div>

  <ion-list [inset]="true">
    @for (item of [1, 2, 3, 4, 5]; track $index) {
    <ion-item>
      <ion-skeleton-text
        slot="start"
        [animated]="true"
        style="width: 20px; height: 16px"
      ></ion-skeleton-text>
      <div class="athlete-info">
        <ion-skeleton-text
          [animated]="true"
          style="width: 140px; height: 16px; margin-bottom: 4px"
        ></ion-skeleton-text>
        <ion-skeleton-text
          [animated]="true"
          style="width: 100px; height: 12px"
        ></ion-skeleton-text>
      </div>
      <div slot="end" class="scores-container">
        <ion-skeleton-text
          [animated]="true"
          style="width: 50px; height: 28px; border-radius: 16px"
        ></ion-skeleton-text>
        <ion-skeleton-text
          [animated]="true"
          style="width: 50px; height: 28px; border-radius: 16px"
        ></ion-skeleton-text>
        <ion-skeleton-text
          [animated]="true"
          style="width: 50px; height: 28px; border-radius: 16px"
        ></ion-skeleton-text>
      </div>
    </ion-item>
    }
  </ion-list>
  }
</ion-content>
