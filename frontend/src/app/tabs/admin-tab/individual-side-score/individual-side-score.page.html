<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin"></ion-back-button>
    </ion-buttons>
    <ion-title>Individual Side Scores</ion-title>
    <app-toolbar-buttons slot="end"></app-toolbar-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  @if (dataLoaded()) {
  <!-- Existing Individual Side Scores -->
  @if (individualSideScores().length > 0) {
  <ion-card>
    <ion-card-header>
      <ion-card-title>Existing Individual Side Scores</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        @for (individualSideScore of individualSideScores(); track
        individualSideScore.ordinal + '-' + individualSideScore.crossfit_id) {
        <ion-item>
          <ion-label>
            <h2>{{ getEventName(individualSideScore.ordinal) }}</h2>
            <p>
              {{ getAthleteName(individualSideScore.crossfit_id) }} - {{
              individualSideScore.score_type }}
            </p>
            <p>Score: {{ individualSideScore.score }}</p>
          </ion-label>
          <ion-button
            slot="end"
            fill="outline"
            size="small"
            (click)="loadScore(individualSideScore)"
          >
            Edit
          </ion-button>
          <ion-button
            slot="end"
            fill="outline"
            size="small"
            color="danger"
            (click)="confirmDelete(individualSideScore)"
          >
            Delete
          </ion-button>
        </ion-item>
        }
      </ion-list>
    </ion-card-content>
  </ion-card>
  }

  <!-- Add/Update Form -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Add/Update Individual Side Score</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <!-- Event Selection -->
        <ion-item>
          <ion-select
            label="Event"
            labelPlacement="stacked"
            placeholder="Select event"
            interface="popover"
            [(ngModel)]="selectedOrdinal"
          >
            @for (event of currentYearAllEvents(); track $index) {
            <ion-select-option [value]="event.ordinal">
              {{ event.event }}
            </ion-select-option>
            }
          </ion-select>
        </ion-item>

        <!-- Score Type -->
        <ion-item>
          <ion-select
            label="Score Type"
            interface="popover"
            labelPlacement="stacked"
            [(ngModel)]="selectedScoreType"
          >
            <ion-select-option value="appreciation"
              >Appreciation</ion-select-option
            >
            <ion-select-option value="rookie">Rookie</ion-select-option>
          </ion-select>
        </ion-item>

        <!-- Athlete Selection -->
        <ion-item (click)="openAthleteSelectModal()">
          <ion-label>Athlete</ion-label>
          <ion-label slot="end">
            {{ selectedAthleteName() || 'Click to select' }}
          </ion-label>
        </ion-item>

        <!-- Score -->
        <ion-item>
          <ion-input
            label="Score"
            labelPlacement="stacked"
            type="number"
            placeholder="Enter score"
            [(ngModel)]="score"
          ></ion-input>
        </ion-item>
      </ion-list>

      <div class="button-container">
        <ion-button expand="block" (click)="save()">Save</ion-button>
        <ion-button expand="block" fill="outline" (click)="resetForm()"
          >Clear</ion-button
        >
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Apply Scores -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Apply Individual Side Scores</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>
        Apply all saved individual side scores. This will update individual
        totals.
      </p>
      <ion-button expand="block" color="primary" (click)="apply()">
        Apply Individual Side Scores
      </ion-button>
    </ion-card-content>
  </ion-card>
  } @else {
  <!-- Loading State -->
  <ion-card>
    <ion-card-header>
      <ion-skeleton-text
        [animated]="true"
        style="width: 50%"
      ></ion-skeleton-text>
    </ion-card-header>
    <ion-card-content>
      <ion-skeleton-text
        [animated]="true"
        style="width: 80%"
      ></ion-skeleton-text>
      <ion-skeleton-text
        [animated]="true"
        style="width: 60%"
      ></ion-skeleton-text>
      <ion-skeleton-text
        [animated]="true"
        style="width: 90%"
      ></ion-skeleton-text>
    </ion-card-content>
  </ion-card>
  }

  <ion-alert
    [isOpen]="deleteAlertOpen()"
    header="Confirm Delete"
    message="Are you sure you want to delete this individual side score?"
    [buttons]="deleteAlertButtons"
  ></ion-alert>
</ion-content>
