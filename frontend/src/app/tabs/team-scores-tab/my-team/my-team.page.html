<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="team-scores"></ion-back-button>
    </ion-buttons>
    <ion-title>Team Composition</ion-title>
    <app-toolbar-buttons slot="end"></app-toolbar-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-card class="team-selector-card">
    <ion-card-content>
      <ion-select
        label="Select Team"
        labelPlacement="floating"
        [value]="scoreFilter.filter().team"
        (ionChange)="onSelectionChanged($event)"
        interface="popover"
        fill="outline"
      >
        @for (team of teamsList(); track $index) {
        <ion-select-option [value]="team"
          >{{ team | teamName }}</ion-select-option
        >
        }
      </ion-select>
    </ion-card-content>
  </ion-card>

  @if ( dataLoaded()) {
  <div class="section-header">
    <h2 class="section-title">{{ teamSectionTitle() }}</h2>
    <ion-chip color="primary">
      <ion-icon name="people-outline"></ion-icon>
      <ion-label>{{ filteredAthletes().length }}</ion-label>
    </ion-chip>
  </div>
  <ion-card class="gender-card">
    <ion-card-header>
      <div class="card-title-row">
        <div class="gender-badge female">
          <ion-icon name="woman-outline"></ion-icon>
          <span>Female</span>
        </div>
        <ion-chip color="secondary" class="count-chip">
          <ion-label>{{ filtereedAthletesByGender().F.length }}</ion-label>
        </ion-chip>
      </div>
    </ion-card-header>
    <ion-list [inset]="true">
      @for (athlete of filtereedAthletesByGender().F; track $index) {
      <ion-item lines="full">
        <div class="athlete-info">
          <ion-label class="athlete-name">{{ athlete.name }}</ion-label>
          <div class="athlete-details">
            @if (athlete.judge) {
            <ion-chip size="small" color="tertiary">
              <ion-icon name="checkmark-circle"></ion-icon>
              <ion-label>Judge</ion-label>
            </ion-chip>
            }
            <ion-chip size="small" outline="true">
              <ion-label>{{ athlete.age_category }}</ion-label>
            </ion-chip>
          </div>
        </div>
      </ion-item>
      } @empty {
      <ion-item lines="none">
        <ion-label class="empty-state">No athletes registered yet</ion-label>
      </ion-item>
      }
    </ion-list>
  </ion-card>
  <ion-card class="gender-card">
    <ion-card-header>
      <div class="card-title-row">
        <div class="gender-badge male">
          <ion-icon name="man-outline"></ion-icon>
          <span>Male</span>
        </div>
        <ion-chip color="secondary" class="count-chip">
          <ion-label>{{ filtereedAthletesByGender().M.length }}</ion-label>
        </ion-chip>
      </div>
    </ion-card-header>
    <ion-list [inset]="true">
      @for (athlete of filtereedAthletesByGender().M; track $index) {
      <ion-item lines="full">
        <div class="athlete-info">
          <ion-label class="athlete-name">{{ athlete.name }}</ion-label>
          <div class="athlete-details">
            @if (athlete.judge) {
            <ion-chip size="small" color="tertiary">
              <ion-icon name="checkmark-circle"></ion-icon>
              <ion-label>Judge</ion-label>
            </ion-chip>
            }
            <ion-chip size="small" outline="true">
              <ion-label>{{ athlete.age_category }}</ion-label>
            </ion-chip>
          </div>
        </div>
      </ion-item>
      } @empty {
      <ion-item lines="none">
        <ion-label class="empty-state">No athletes registered yet</ion-label>
      </ion-item>
      }
    </ion-list>
  </ion-card>
  } @else {
  <div class="section-header">
    <ion-skeleton-text
      [animated]="true"
      style="width: 180px; height: 28px; border-radius: 8px"
    ></ion-skeleton-text>
  </div>
  <ion-card class="gender-card">
    <ion-card-header>
      <ion-skeleton-text
        [animated]="true"
        style="width: 100px; height: 24px; border-radius: 6px"
      ></ion-skeleton-text>
    </ion-card-header>
    <ion-list [inset]="true">
      @for (item of [1,2,3,4,5]; track $index) {
      <ion-item>
        <div class="athlete-info">
          <ion-skeleton-text
            [animated]="true"
            style="width: 60%; height: 20px; margin-bottom: 8px"
          ></ion-skeleton-text>
          <ion-skeleton-text
            [animated]="true"
            style="width: 40%; height: 16px"
          ></ion-skeleton-text>
        </div>
      </ion-item>
      }
    </ion-list>
  </ion-card>
  }
</ion-content>
